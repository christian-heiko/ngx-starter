{"version":3,"sources":["../../../../src/features/global-search/global-search.component.ts"],"names":[],"mappings":"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","file":"global-search.component.js","sourceRoot":"","sourcesContent":["import {\n  Component, ElementRef, EventEmitter, Input, OnDestroy, OnInit, Output, ViewChild,\n} from \"@angular/core\";\nimport {GlobalSearchService, SearchQuery, SortOption} from \"./global-search.service\";\nimport {NavigationEnd, Router} from \"@angular/router\";\nimport {Subscription} from \"rxjs/Subscription\";\nimport {Sort} from \"../../common/data/page\";\n\n\n\n\nexport class GlobalSearchComponent implements OnInit, OnDestroy {\n\n  private _searchCollapsed : boolean = true;\n  private _txtSearch: ElementRef;\n  private _subs : Subscription[] = [];\n\n  \n  public onSearchCollapsed = new EventEmitter<boolean>();\n\n  public availableSort : SortOption[] = [];\n  public selectedSort : SortOption = this.availableSort[0];\n  public sortAsc : boolean = false;\n  public globalSearchDisabled : boolean;\n\n  constructor(\n    private router : Router,\n    private globalSearch : GlobalSearchService) {\n\n    this.globalSearchDisabled = !globalSearch.showGlobalSearch;\n\n\n    this._subs.push(\n\n      globalSearch.showGlobalSearchObservable\n        .subscribe(value => {\n          this.globalSearchDisabled = !value;\n        }),\n\n      this.globalSearch.availableSortsObservable\n        .subscribe(available => {\n          this.availableSort = available;\n        }),\n\n      router.events\n        .filter(event => event instanceof NavigationEnd)\n        .subscribe(() => {\n          this.searchCollapsed = true;\n        })\n    );\n\n  }\n\n  ngOnInit() {\n    this.searchCollapsed = true;\n  }\n\n\n  ngOnDestroy(): void {\n    this._subs.forEach(sub => sub.unsubscribe());\n  }\n\n  \n  get searchCollapsed() : boolean {\n    return this._searchCollapsed;\n  }\n\n  \n  set txtSearch(input : ElementRef) {\n    this._txtSearch = input;\n  }\n\n  set searchCollapsed(value : boolean){\n    this._searchCollapsed = value;\n    this.onSearchCollapsed.emit(this.searchCollapsed);\n    if(!this._searchCollapsed){\n      setTimeout(() => this._txtSearch.nativeElement.focus(), 0);\n    }\n  }\n\n  get toggleIcon() : string {\n    return this.searchCollapsed ? 'search' : 'close';\n  }\n\n  public toggleSearch(){\n    if(this.searchCollapsed){\n      // Show search\n      this.searchCollapsed = false;\n    }else{\n      // Collapse search\n      this.searchCollapsed = true;\n      this.globalSearch.query = SearchQuery.Empty;\n    }\n  }\n\n  public toggleSortAsc() : void {\n    this.sortAsc = !this.sortAsc;\n    this.onQueryChanged();\n  }\n\n  public sortBy(sort : SortOption){\n    this.selectedSort = sort;\n    this.onQueryChanged();\n  }\n\n  public onQueryChanged(){\n\n    let sorts = this.selectedSort ? [this.convertToSort(this.selectedSort)] : [];\n\n    let newQuery = new SearchQuery(\n      this.keywordsValue,\n      sorts\n    );\n\n    this.globalSearch.query = newQuery;\n  }\n\n  private convertToSort(sort  : SortOption) : Sort {\n      return new Sort(sort.id, this.sortAsc ? 'asc' : 'desc');\n  }\n\n  private get keywordsValue() : string {\n    if(this._txtSearch){\n      let txtInput = this._txtSearch.nativeElement as HTMLInputElement;\n      return txtInput.value;\n    }\n    return '';\n  }\n\nstatic decorators: DecoratorInvocation[] = [\n{ type: Component, args: [{\n  selector: 'global-search',\n  templateUrl: './global-search.component.html',\n  styleUrls: ['./global-search.component.scss']\n}, ] },\n];\n/** @nocollapse */\nstatic ctorParameters: () => ({type: any, decorators?: DecoratorInvocation[]}|null)[] = () => [\n{type: Router, },\n{type: GlobalSearchService, },\n];\nstatic propDecorators: {[key: string]: DecoratorInvocation[]} = {\n'onSearchCollapsed': [{ type: Output },],\n'searchCollapsed': [{ type: Input },],\n'txtSearch': [{ type: ViewChild, args: ['txtSearch', ] },],\n};\n}\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}