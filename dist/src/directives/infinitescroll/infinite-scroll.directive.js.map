{"version":3,"sources":["../../../../src/directives/infinitescroll/infinite-scroll.directive.ts"],"names":[],"mappings":"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","file":"infinite-scroll.directive.js","sourceRoot":"","sourcesContent":["import {Directive, ElementRef, Input, OnDestroy, Output} from '@angular/core';\nimport {ReplaySubject} from \"rxjs/ReplaySubject\";\nimport {Observable} from \"rxjs/Observable\";\n\n\n\nexport class InfiniteScrollDirective implements OnDestroy{\n\n  \n  public eventThrottle = 150;\n\n  \n  public offsetFactor : number = 1;\n\n  \n  public ignoreScrollEvent : boolean = false;\n\n  public _scrollStream$: ReplaySubject<UIEvent> = new ReplaySubject(1);\n  private scrollContainer : HTMLElement;\n\n  constructor(el: ElementRef) {\n  }\n\n  \n  get closeToEnd() : Observable<UIEvent>{\n    return this._scrollStream$\n      .throttleTime(this.eventThrottle)\n      .filter(ev => this.isCloseToEnd(ev.srcElement as HTMLElement))\n      ;\n  }\n\n\n  \n  set containerId(containerId : string) {\n    let scrollContainer = document.getElementById(containerId);\n    if(scrollContainer){\n      console.log(\"Found scroll container: \", scrollContainer);\n      this.setup(scrollContainer);\n    }\n  }\n\n  ngOnDestroy(): void {\n    if(this.scrollContainer){\n      this.scrollContainer.onscroll = null as any;\n    }\n  }\n\n  private setup(scrollContainer : HTMLElement) : void {\n\n    console.log(\"Setting up scroll observable stream listener....\");\n\n    this.scrollContainer = scrollContainer;\n\n    this.scrollContainer.onscroll = ev => {\n      if(this.ignoreScrollEvent) return;\n      this._scrollStream$.next(ev);\n    };\n  }\n\n  private isCloseToEnd(el : HTMLElement) : boolean {\n    const range = el.offsetHeight * this.offsetFactor;\n    let total = el.scrollHeight;\n    let current = el.scrollTop + el.offsetHeight;\n    return (total-current) < range;\n  }\n\n\nstatic decorators: DecoratorInvocation[] = [\n{ type: Directive, args: [{ selector: '[infiniteScroll]' }, ] },\n];\n/** @nocollapse */\nstatic ctorParameters: () => ({type: any, decorators?: DecoratorInvocation[]}|null)[] = () => [\n{type: ElementRef, },\n];\nstatic propDecorators: {[key: string]: DecoratorInvocation[]} = {\n'eventThrottle': [{ type: Input, args: ['eventThrottle', ] },],\n'offsetFactor': [{ type: Input, args: ['offsetFactor', ] },],\n'ignoreScrollEvent': [{ type: Input, args: ['ignoreScrollEvent', ] },],\n'closeToEnd': [{ type: Output, args: ['closeToEnd', ] },],\n'containerId': [{ type: Input, args: ['containerId', ] },],\n};\n}\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}